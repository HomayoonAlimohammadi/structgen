{{ $recipe := . }}
{{ if $recipe.GenerateCmd }}
// Code generated by running "{{ $recipe.GenerateCmd }}" via StructGen. DO NOT EDIT.
{{ else }}
// Code generated by StructGen. DO NOT EDIT.
{{ end }}
//
// This file was autogenerated by the {{ $recipe.ToolName }} tool on {{ $recipe.GenerateDate }}.
// Any changes will be overwritten.
//
// These files are generated from the values.yaml files in the k8s/manifests/charts directory.
//
// Package {{ $recipe.PkgName }} contains the Go structs representing the values of the Helm chart.
package {{ $recipe.PkgName }}

{{ if $recipe.Imports }}
import (
    {{ range $import := $recipe.Imports -}}
        {{ if $import.Alias }} {{ $import.Alias }} {{ end }} "{{ $import.Path }}"
    {{ end }}
)
{{ end }}

{{ range $struct := $recipe.Structs }}
    {{- if $struct.DocString }}
        {{ $struct.DocString }}
    {{ end -}}

    type {{ $struct.Name }} struct {
        {{ range $field := $struct.Fields -}}
            {{- if $field.DocString -}}
                {{ $field.DocString }}
            {{ end -}}
            {{ $field.Name }} {{ $field.Type }} `json:"{{ $field.OriginalYamlName }},omitempty" yaml:"{{ $field.OriginalYamlName }},omitempty"`
        {{ end -}}
    }

    func (v *{{ $struct.Name }}) ToMap() (map[string]any, error) {
        if v == nil {
            return map[string]any{}, nil
        }
        b, err := json.Marshal(v)
        if err != nil {
            return nil, fmt.Errorf("failed to marshal struct to json: %w", err)
        }
        res := map[string]any{} 
        if err := json.Unmarshal(b, &res); err != nil {
            return nil, fmt.Errorf("failed to unmarshal json to map: %w", err)
        }

        return res, nil
    }


{{ end }}

// mergeMaps recursively merges map B into map A. Inner maps will be recursively merged only if both are map[string]any.
// The name is unique to prevent conflicts with other autogenerated files in this package.
func mergeMaps{{ $recipe.RootStructName }}(a, b map[string]any) {
	for key, bValue := range b {
		if aValue, ok := a[key]; ok {
			aMap, aIsMap := aValue.(map[string]any)
			bMap, bIsMap := bValue.(map[string]any)
			if aIsMap && bIsMap {
				mergeMaps{{ $recipe.RootStructName }}(aMap, bMap)
				continue
			}
		}
		a[key] = bValue
	}
}

